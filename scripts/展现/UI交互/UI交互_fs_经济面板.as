_root.UI系统.经济面板动效 = true;
_root.UI系统.经济面板帧间隔 = 60;
_root.UI系统.经济面板动效占比 = 0.2;

_root.UI系统.金钱刷新 = function()
{ 
    _root.UI系统.经济面板刷新(_root.金币图标, "金钱", this.经济面板帧间隔 ,this.经济面板动效占比);
};

_root.UI系统.虚拟币刷新 = function()
{ 
    _root.UI系统.经济面板刷新(_root.K点图标, "虚拟币", this.经济面板帧间隔 ,this.经济面板动效占比);
};

_root.UI系统.经济面板刷新 = function(面板, 变量, 帧间隔, 动效占比)
{ 
    var 货币 = _root[变量];

    if(!面板.已初始化)
    {
        if(!面板)
        {
            return;
        }
        else
        {
            面板.上次记录 = 0;
            面板.上次动画值 = 0;
            面板.显示值 = 0;
            面板.变动值 = 0;
            面板.目标值 = 0;
            面板.帧间隔 = 帧间隔;
            面板.动效帧 = 帧间隔 * 动效占比;
            面板.结束帧 = 帧间隔 - 面板.动效帧;
            面板.动画帧计数器 = 0;
            面板.变动框._alpha = 0;
            面板.动画活跃 = false;
            面板.已初始化 = true;
            
        }
    }

    if(面板.显示值 != 货币 && this.经济面板动效 && 货币 >= 0)
    {
        if (!面板.动画活跃 || 面板.目标值 != 货币) {
            面板.动画帧计数器 = 0;
            面板.上次记录 = Number(面板.显示值) || 0; // 确保始终为数字
            if(面板.动画活跃)
            {
                面板.变动值 = 货币 - 面板.上次动画值;
            }
            else
            {
                面板.变动值 = 货币 - 面板.上次记录;
                面板.上次动画值 = 面板.上次记录;
            }
            
            if(面板.变动值 > 0)
            {
                面板.变动值 = "+" + 面板.变动值;
            }
            面板.变动值 = 面板.变动值; // 在动画最后一帧确保精确设置目标值
            面板.目标值 = 货币;
            面板.动画活跃 = true;
        }
        
        if (面板.动画活跃)
        {
            面板.动画帧计数器++;
            var 变动框透明度 = 100;
            if (面板.动画帧计数器 <= 面板.动效帧) {
                变动框透明度 = 面板.动画帧计数器 / 面板.动效帧 * 100;
            } else if (面板.动画帧计数器 >= 面板.结束帧) {
                变动框透明度 = (面板.帧间隔 - 面板.动画帧计数器) / 面板.动效帧 * 100;
            }

            面板.变动框._alpha = 变动框透明度;

            if (面板.动画帧计数器 < 面板.帧间隔)
            {
                var 改变量 = 面板.目标值 - 面板.上次记录;
                var 当前显示值 = 面板.上次记录 + (改变量 * (面板.动画帧计数器 / 面板.帧间隔));
                面板.显示值 = Math.round(当前显示值);
            }
            else
            {
                面板.显示值 = 面板.目标值; // 在动画最后一帧确保精确设置目标值
                面板.变动值 = ""; // 在动画最后一帧确保精确设置目标值
                面板.动画活跃 = false;  // 结束动画
            }
        }
    }
    else
    {
        面板.显示值 = 货币;  // 直接更新显示值，无动画
    }
};




